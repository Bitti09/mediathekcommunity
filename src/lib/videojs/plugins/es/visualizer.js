/**
 * Copyright (c) 2022 The Nuevodevel Team. All rights reserved.
 * Visualizer plugin for video.js
 * Version 1.2.0
 */
/* eslint-disable */import videojs from"video.js";const registerPlugin=videojs.registerPlugin||videojs.plugin,onPlayerReady=(e,t)=>{var i,o=e.el(),r=e.$(".vjs-tech"),n={video:!1,color1:"#ffcc00",color2:"#ff0000",capsColor:"#fff",caps:!1,bottom:0,height:50,f_play:!1};try{i=videojs.obj.merge(n,t||{})}catch(e){i=videojs.mergeOptions(n,t||{})}if(!0===function(){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(window.AudioContext)return!0;else return!1}()){var a,l,s,c,f,d,u,h,p=!0,v=new WeakMap,m="50",w="0";if(parseInt(i.height,10)>0&&parseInt(i.height,10)<=100)m=parseInt(i.height,10);if(parseInt(i.bottom,10)>0)w=parseInt(i.bottom,10)+"%";var y=".vjs-visualizer{left:0;z-index:4;position:absolute;padding:0 10px;bottom:"+w+";width:100%;height:"+m+"%;pointer-events:none;}";e.on("playerresize",function(){g()});S(y);(s=document.createElement("canvas")).className="vjs-visualizer";s.id="visualizer";o.insertBefore(s,e.controlBar.el_);g();e.ready(function(){a=!1;e.on("loadeddata",function(){if(e.currentType().indexOf("audio")>-1)a=!0;else a=!1;i.f_play=!1;if(i.video)a=!0});function t(){r=e.$(".vjs-tech");try{if(void 0===l)l=new AudioContext;if(v.has(r))u=v.get(r);else{u=l.createMediaElementSource(r);v.set(r,u)}h=l.createAnalyser();s.width=s.offsetWidth;s.height=3*s.height;d=s.getContext("2d");u.connect(h);h.connect(l.destination)}catch(e){}}e.on("playing",function(){if(!i.f_play){if(void 0!==e.currentSource().av)p=!1;o.querySelector(".vjs-background-bar");i.f_play=!0;if(a&&p){t();function n(e,t){e=e.replace("#","");var i=parseInt(3===e.length?e.slice(0,1).repeat(2):e.slice(0,2),16),o=parseInt(3===e.length?e.slice(1,2).repeat(2):e.slice(2,4),16),r=parseInt(3===e.length?e.slice(2,3).repeat(2):e.slice(4,6),16);if(t)return"rgba("+i+", "+o+", "+r+", "+t+")";else return"rgb("+i+", "+o+", "+r+")"}if(i.color1.indexOf("#")<0)i.color1="#"+i.color1;if(i.color2.indexOf("#")<0)i.color2="#"+i.color2;var l="#ffcc00",u="#ff0000",v="#fff",m=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;if(m.test(i.capsColor))v=i.capsColor;if(m.test(i.color1))l=i.color1;if(m.test(i.color2))u=i.color2;var w=n(l),y=n(u),g=n(l,.2),S=[];function j(){if(a){r=e.$(".vjs-tech");var t=o.querySelector(".vjs-background-bar");if(t)t.style.display="none";h.fftSize=256;c=h.frequencyBinCount;s.width=o.offsetWidth-20;var n=s.width/c*1.2;if(n<6)n=6;var l,u=1;if(s.width<500)u=2;window.RequestAnimationFrame=window.requestAnimationFrame(j)||window.msRequestAnimationFrame(j)||window.mozRequestAnimationFrame(j)||window.webkitRequestAnimationFrame(j);var p=0;f=new Uint8Array(c);h.getByteFrequencyData(f);d.clearRect(0,0,s.width,s.height);for(var m=0;m<c;m+=u){m=parseInt(m,10);l=f[m];if(p+n<s.width){var q=d.createLinearGradient(0,0,0,.5*s.height);q.addColorStop(1,w);q.addColorStop(.5,y);q.addColorStop(0,y);var A=s.height/1.5-l,b=s.height/1.5;d.fillStyle=q;d.fillRect(p,A,n,l);if(i.caps)if(S[p]){d.fillStyle=v;if(A<S[p]){S[p]=A;if(A!==b)d.fillRect(p,A-6,n,3)}else{S[p]=S[p]+1;if(S[p]<b)d.fillRect(p,S[p]-6,n,3)}}else S[p]=A;d.fillStyle=g;d.fillRect(p,s.height/1.5,n,l/2);p+=n+4}}}else try{d.clearRect(0,0,s.width,s.height)}catch(e){}}window.RequestAnimationFrame=window.requestAnimationFrame(j)||window.msRequestAnimationFrame(j)||window.mozRequestAnimationFrame(j)||window.webkitRequestAnimationFrame(j)}}})});return this}function g(){var t=e.el_.querySelector(".vjs-visualizer"),i=0,o=e.el_.querySelector(".vjs-control-bar"),r=t.offsetHeight,n=parseInt(getComputedStyle(o).getPropertyValue("height"),10);n+=parseInt(getComputedStyle(o).getPropertyValue("bottom"),10);var a=10;if(e.el_.querySelector(".vjs-skin-treso"))a=20;if(e.el_.querySelector(".vjs-skin-mockup"))a=30;if(e.el_.querySelector(".vjs-skin-jwlike"))a=15;i=n-r/3+a;t.style.bottom=i+"px"}function S(e){var t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css";if(i.styleSheet)i.styleSheet.cssText=e;else i.appendChild(document.createTextNode(e));t.appendChild(i)}},visualizer=function(e){this.ready(()=>{onPlayerReady(this,e)})};if("undefined"!=typeof window)registerPlugin("visualizer",visualizer);visualizer.VERSION="1.0";export default visualizer;
